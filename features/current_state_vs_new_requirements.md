# Current State vs. New Requirements

This document outlines the differences between the current state of the algorithmic trading application and the new requirements outlined in the updated technical requirements document.

## Architecture

| Feature          | Current State                                                                                                                                                                                                                                                           | New Requirements                                                                                                                                                                                                                                                                                                                                                        |
| ---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **AI Integration** | Simulated Claude responses in the Go backend using a custom `claude` package.  Frontend communicates with the backend via WebSockets to receive "streaming" responses and the final trading signal.                                                                  | Real Claude integration using the Anthropic TypeScript SDK in the Next.js frontend.  Frontend communicates directly with the Anthropic API.  Go backend no longer handles AI interaction.                                                                                                                                                                    |
| **Frontend Role** | Primarily displays data received from the backend.  Limited interaction with the trading process.                                                                                                                                                                    | Primary point of interaction for the user and the AI.  Handles multi-stage prompting, user input for risk/profit parameters and trading strategy, displays streaming responses from Claude, and initiates automated trading.                                                                                                                             |
| **Backend Role**  | Handles market data, simulated AI responses, WebSocket communication with the frontend, and trade execution via the Alpaca API.                                                                                                                                       | Primarily responsible for trade execution via the Alpaca API based on JSON signals received from the frontend.  Manages market data feed, tracks positions, and implements automated trading logic (take profits/reinvest).  No longer handles AI interaction or WebSocket communication for AI responses.                                               |
| **Communication** | Frontend and backend communicate via WebSockets.  The format of the messages is custom to the application.                                                                                                                                                           | Frontend and backend communicate via a REST API (`/api/executeTrade`) using JSON payloads.  The frontend communicates with Claude using the Anthropic SDK, also receiving JSON responses. The backend still uses websockets to stream market data from Alpaca.                                                                                 |
| **Algorithm Selection** |  The trading algorithm uses a hardcoded, simulated signal generation logic.                                                                                                                                                                                           | The system uses algorithms from "Advances in Financial Machine Learning" by Marcos LÃ³pez de Prado. Claude recommends appropriate algorithms based on market conditions, and the user can confirm or refine these recommendations. The backend algorithm implementation is modular to support dynamic algorithm selection. |
| **User Interaction** | Limited user interaction, primarily focused on viewing data and selecting tickers.                                                                                                                                                                                    | Extensive user interaction, including: confirming/refining algorithm selections, answering questions about risk tolerance and profit targets, choosing a trading strategy (take profits or reinvest), and enabling/disabling automated trading.                                                                                                 |
| **Automated Trading** | No automated trading functionality.                                                                                                                                                                                                                                  | Automated trading is implemented, with options for taking profits or reinvesting based on user preference.  The frontend initiates and controls automated trading, sending trade requests to the backend based on Claude's signals.                                                                                                                |
| **Error Handling** | Basic error handling.                                                                                                                                                                                                                                                  | More robust error handling, including handling API failures (Anthropic and Alpaca), invalid user input, and trade execution errors.  Fallback mechanisms for algorithm selection.                                                                                                                                                                        |
| **Data Format** | Custom data formats for WebSocket communication.                                                                                                                                                                                                                         | Standardized JSON format for communication between the frontend and backend, and for receiving responses from Claude.                                                                                                                                                                                                                             |

## Component Changes

*   **`claude/` (Go package):**  Will be removed entirely.
*   **`main.go` (Go):**  Will be modified to remove Claude simulation logic, add the `/api/executeTrade` endpoint, and refactor the trading algorithm.
*   **`algorithm/` (Go package):** Will be refactored to support dynamic algorithm selection and application, and to handle automated trading logic.
*   **`web-ui/src/components/ClaudeResponse.tsx` (Next.js):** Will be renamed to `ClaudeTradingSignal.tsx` and completely rewritten to use the Anthropic SDK and implement the multi-stage prompting and automated trading logic.
*   **`web-ui/src/app/page.tsx` (and other existing pages):**  Likely won't be directly modified, but a new page (`app/trade/page.tsx`) will be added.
* **`web-ui/src/components/Sidebar.tsx`:** Will need to be updated to include a link to the new trading page.

This document provides a high-level overview of the changes.  The `technical_requirements_document.md` file provides more detailed technical specifications.